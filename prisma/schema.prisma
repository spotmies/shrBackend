generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ------------------------------------------------------
// ENUMS
// ------------------------------------------------------

enum UserRole {
  admin
  user
  supervisor

  @@map("users_role_enum")
}

enum ProjectType {
  villa
  apartment
  building

  @@map("projects_projecttype_enum")
}

enum ProjectStatus {
  Planning
  Inprogress
  OnHold

  @@map("projects_initialstatus_enum")
}

enum SupervisorStatus {
  Active
  Inactive
  reject

  @@map("supervisors_status_enum")
}

enum ConstructionStage {
  Foundation
  Framing
  Plumbing___Electrical @map("Plumbing & Electrical")
  Interior_Walls        @map("Interior Walls")
  Painting
  Finishing

  @@map("daily_updates_constructionstage_enum")
}

enum DailyUpdateStatus {
  pending
  approved
  rejected

  @@map("daily_updates_status_enum")
}

enum DocumentType {
  Agreement
  plans
  permit
  others

  @@map("documents_documenttype_enum")
}

enum ExpenseCategory {
  Labor
  Equipment
  Permits
  Materials

  @@map("expenses_category_enum")
}

enum ExpenseStatus {
  pending
  approved
  rejected

  @@map("expenses_status_enum")
}

enum PaymentStatus {
  pending
  completed
  failed
  refunded

  @@map("payments_paymentstatus_enum")
}

enum PaymentMethod {
  cash
  card
  bank_transfer
  cheque
  online

  @@map("payments_paymentmethod_enum")
}

enum QuotationStatus {
  pending
  approved
  rejected
  locked

  @@map("quotations_status_enum")
}

// ------------------------------------------------------
// MODELS
// ------------------------------------------------------

model User {
  userId              String   @id @default(uuid()) @db.Uuid
  userName            String   @db.VarChar(255)
  role                UserRole
  email               String   @db.VarChar(100)
  password            String?  @db.VarChar(255)
  contact             String   @db.VarChar(15)
  estimatedInvestment Decimal? @db.Decimal(12, 2)
  notes               String?  @db.Text
  supervisorId        String?  @db.Uuid
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  projects Project[]

  @@map("users")
}

model Project {
  projectId          String        @id @default(uuid()) @db.Uuid
  projectName        String        @db.VarChar(255)
  projectType        ProjectType
  location           String        @db.VarChar(255)
  initialStatus      ProjectStatus
  startDate          DateTime      @db.Date
  expectedCompletion DateTime      @db.Date
  totalBudget        Decimal       @db.Decimal(12, 2)
  materialName       String        @db.VarChar(255)
  quantity           Int
  notes              String        @db.Text
  
  userId             String?       @db.Uuid
  user               User?         @relation(fields: [userId], references: [userId])
  
  supervisorId       String?       @db.Uuid
  supervisor         Supervisor?   @relation(fields: [supervisorId], references: [supervisorId])

  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")

  dailyUpdates DailyUpdate[]
  documents    Document[]
  expenses     Expense[]
  materials    Material[]
  payments     Payment[]
  quotations   Quotation[]

  @@map("projects")
}

model Supervisor {
  supervisorId String           @id @default(uuid()) @db.Uuid
  fullName     String           @db.VarChar(255)
  email        String           @unique @db.VarChar(100)
  phoneNumber  String           @db.VarChar(15)
  password     String?          @db.VarChar(255)
  status       SupervisorStatus @default(Active)
  approve      String?          @db.VarChar(50)
  createdAt    DateTime         @default(now()) @map("created_at")
  updatedAt    DateTime         @updatedAt @map("updated_at")

  projects Project[]

  @@map("supervisors")
}

model DailyUpdate {
  dailyUpdateId     String            @id @default(uuid()) @db.Uuid
  constructionStage ConstructionStage @default(Foundation)
  description       String?           @db.Text
  rawMaterials      Json?             @default("[]")
  imageUrl          String?           @db.VarChar(500)
  imageName         String?           @db.VarChar(255)
  imageType         String?           @db.VarChar(100)
  videoUrl          String?           @db.VarChar(500)
  status            DailyUpdateStatus @default(pending)
  
  projectId         String?           @db.Uuid
  project           Project?          @relation(fields: [projectId], references: [projectId])
  
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")

  @@map("daily_updates")
}

model AuthLogin {
  authLoginId String @id @default(uuid()) @db.Uuid
  email       String @db.VarChar(255)
  password    String @db.VarChar(255)

  @@map("auth_login")
}

model Document {
  documentId   String       @id @default(uuid()) @db.Uuid
  documentType DocumentType @default(Agreement)
  fileData     Bytes        @db.ByteA
  fileName     String       @db.VarChar(255)
  fileType     String       @db.VarChar(100)
  description  String?      @db.VarChar(500)
  
  projectId    String?      @db.Uuid
  project      Project?     @relation(fields: [projectId], references: [projectId])
  
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")

  @@map("documents")
}

model Expense {
  expenseId   String          @id @default(uuid()) @db.Uuid
  
  projectId   String          @db.Uuid
  project     Project         @relation(fields: [projectId], references: [projectId])
  
  category    ExpenseCategory
  amount      Decimal         @db.Decimal(12, 2)
  date        DateTime        @db.Date
  description String?         @db.Text
  status      ExpenseStatus   @default(pending)
  
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")

  @@map("expenses")
}

model Material {
  materialId   String   @id @default(uuid()) @db.Uuid
  
  projectId    String   @db.Uuid
  project      Project  @relation(fields: [projectId], references: [projectId])
  
  materialName String   @db.VarChar(255)
  quantity     Int
  date         DateTime @db.Date
  notes        String?  @db.Text
  
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("materials")
}

model Payment {
  paymentId     String        @id @default(uuid()) @db.Uuid
  amount        Decimal       @db.Decimal(12, 2)
  
  projectId     String?       @db.Uuid
  project       Project?      @relation(fields: [projectId], references: [projectId])
  
  paymentStatus PaymentStatus @default(pending)
  paymentMethod PaymentMethod @default(cash)
  paymentDate   DateTime      @db.Date
  remarks       String?       @db.Text
  
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  @@map("payments")
}

model Quotation {
  quotationId String          @id @default(uuid()) @db.Uuid
  totalAmount Decimal         @db.Decimal(12, 2)
  status      QuotationStatus @default(pending)
  lineItems   Json?           @default("[]")
  date        DateTime?       @db.Date
  
  projectId   String?         @db.Uuid
  project     Project?        @relation(fields: [projectId], references: [projectId])
  
  fileData    Bytes?          @db.ByteA
  fileName    String?         @db.VarChar(255)
  fileType    String?         @db.VarChar(100)
  fileUrl     String?         @db.Text
  
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")

  @@map("quotations")
}
